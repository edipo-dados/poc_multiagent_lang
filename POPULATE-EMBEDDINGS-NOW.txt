üîÑ POPULAR EMBEDDINGS - COMANDOS CORRETOS
==========================================

O script foi corrigido para funcionar no Docker!

CORRE√á√ïES FEITAS:
-----------------
‚úÖ Hostname: postgres (n√£o localhost)
‚úÖ Tabela: code_embeddings (n√£o embeddings)
‚úÖ Caminho: /app/fake_pix_repo (usa PIX_REPO_PATH env var)

COMANDOS NO EC2:
----------------

1. Pull das mudan√ßas:
   cd ~/poc_multiagent_lang
   git pull origin main

2. Rebuild backend (para pegar script atualizado):
   docker compose down backend
   docker compose up -d --build backend

3. Popular embeddings:
   docker compose exec backend python /app/backend/scripts/populate_embeddings_sync.py

4. Verificar se funcionou:
   docker compose exec postgres psql -U postgres -d regulatory_ai -c "SELECT COUNT(*) FROM code_embeddings;"

SA√çDA ESPERADA:
---------------
Populando embeddings para fake_pix_repo...

  Processando: api/endpoints.py
    Gerando embedding...
    Salvando no banco...
    ‚úì Conclu√≠do (384 dimens√µes)

  Processando: api/schemas.py
    Gerando embedding...
    Salvando no banco...
    ‚úì Conclu√≠do (384 dimens√µes)

  Processando: domain/models.py
    Gerando embedding...
    Salvando no banco...
    ‚úì Conclu√≠do (384 dimens√µes)

  Processando: domain/validators.py
    Gerando embedding...
    Salvando no banco...
    ‚úì Conclu√≠do (384 dimens√µes)

  Processando: database/models.py
    Gerando embedding...
    Salvando no banco...
    ‚úì Conclu√≠do (384 dimens√µes)

‚úì Total de embeddings no banco: 5

VERIFICAR SUCESSO:
------------------
docker compose exec postgres psql -U postgres -d regulatory_ai -c "SELECT file_path, LENGTH(content) as size FROM code_embeddings;"

Deve mostrar 5 arquivos com seus tamanhos.

TESTAR CODEREADER:
------------------
curl -X POST http://localhost:8000/analyze \
  -H 'Content-Type: application/json' \
  -d '{"regulatory_text":"RESOLU√á√ÉO BCB N¬∫ 789/2024 - Estabelece regras para valida√ß√£o de chaves Pix","repo_path":"/app/fake_pix_repo"}'

Agora deve retornar:
- "impacted_files": [lista com arquivos]
- "impact_analysis": [lista com an√°lises]

TROUBLESHOOTING:
----------------

Erro: "Reposit√≥rio n√£o encontrado"
‚Üí Verificar volume montado:
  docker compose exec backend ls -la /app/fake_pix_repo

Erro: "relation code_embeddings does not exist"
‚Üí Criar tabela:
  docker compose exec backend python /app/backend/scripts/create_database.py

Erro: "could not connect to server"
‚Üí Verificar postgres:
  docker compose ps postgres

COMANDOS R√ÅPIDOS (COPY-PASTE):
-------------------------------
cd ~/poc_multiagent_lang
git pull origin main
docker compose down backend
docker compose up -d --build backend
docker compose exec backend python /app/backend/scripts/populate_embeddings_sync.py
docker compose exec postgres psql -U postgres -d regulatory_ai -c "SELECT COUNT(*) FROM code_embeddings;"
