üöÄ HABILITAR TODOS OS AGENTES - DEPLOY COMPLETO
================================================

STATUS ATUAL: 5 de 6 agentes funcionando (83%)
PROBLEMA: CodeReader Agent estava desabilitado (retornando lista vazia)
SOLU√á√ÉO: Habilitado wrapper async + popular embeddings no banco

üìã DEPLOY NO EC2:
-----------------

1. SSH no EC2:
   ssh ubuntu@YOUR_EC2_IP

2. Ir para o diret√≥rio:
   cd ~/poc_multiagent_lang

3. Puxar mudan√ßas:
   git pull origin main

4. Verificar se embeddings existem:
   bash CHECK-EMBEDDINGS.sh

5a. SE EMBEDDINGS EXISTEM (total > 0):
    # Apenas rebuild do backend
    docker compose down backend
    docker compose up -d --build backend
    
5b. SE EMBEDDINGS N√ÉO EXISTEM (total = 0):
    # Popular embeddings primeiro
    docker compose exec backend python -m backend.scripts.populate_embeddings_sync
    
    # Aguardar conclus√£o (pode levar alguns minutos)
    # Depois rebuild
    docker compose down backend
    docker compose up -d --build backend

6. Verificar logs:
   docker compose logs backend --tail=50 -f

7. Testar API:
   curl -X POST http://localhost:8000/analyze \
     -H 'Content-Type: application/json' \
     -d '{"regulatory_text":"RESOLU√á√ÉO BCB N¬∫ 789/2024 - Estabelece regras para valida√ß√£o de chaves Pix","repo_path":"/app/fake_pix_repo"}'

üìä O QUE MUDOU:
---------------

ANTES:
- CodeReader: Wrapper tempor√°rio retornando []
- Impact: Sem arquivos para analisar
- SpecGen: Spec m√≠nima
- KiroPrompt: Prompt gen√©rico

DEPOIS:
- CodeReader: Busca sem√¢ntica real no vector store
- Impact: Analisa arquivos identificados
- SpecGen: Spec detalhada com componentes
- KiroPrompt: Prompt espec√≠fico com mudan√ßas

üîç VERIFICAR SUCESSO:
---------------------

No response da API, voc√™ deve ver:

1. "impacted_files": [lista com at√© 10 arquivos]
   - Cada arquivo tem: file_path, relevance_score, snippet
   
2. "impact_analysis": [lista com an√°lises de impacto]
   - Cada impacto tem: file_path, severity, description, suggested_changes
   
3. "technical_spec": Markdown detalhado com:
   - Affected Components (n√£o mais "No impacted components")
   - Required Changes (mudan√ßas espec√≠ficas por arquivo)
   
4. "kiro_prompt": Prompt com:
   - FILE MODIFICATIONS espec√≠ficas
   - Mudan√ßas detalhadas por arquivo

‚ùå SE DER ERRO:
---------------

Erro: "Table code_embeddings does not exist"
Solu√ß√£o: Rodar script de cria√ß√£o de tabelas
  docker compose exec backend python -m backend.scripts.create_database

Erro: "No embeddings found"
Solu√ß√£o: Popular embeddings
  docker compose exec backend python -m backend.scripts.populate_embeddings_sync

Erro: "Event loop is already running"
Solu√ß√£o: J√° corrigido no c√≥digo (usa new_event_loop)

Erro: "Connection refused to postgres"
Solu√ß√£o: Verificar se postgres est√° rodando
  docker compose ps postgres

üìà PERFORMANCE ESPERADA:
------------------------

Com todos os agentes ativos:
- Tempo total: 15-25 segundos
- Sentinel: ~2s
- Translator: ~3s
- CodeReader: ~2s (busca sem√¢ntica)
- Impact: ~5-10s (analisa m√∫ltiplos arquivos)
- SpecGen: ~2s
- KiroPrompt: ~1s

üéØ COMANDOS R√ÅPIDOS (COPY-PASTE):
----------------------------------

# Verificar embeddings
bash CHECK-EMBEDDINGS.sh

# Popular embeddings (se necess√°rio)
docker compose exec backend python -m backend.scripts.populate_embeddings_sync

# Rebuild backend
docker compose down backend
docker compose up -d --build backend

# Ver logs
docker compose logs backend --tail=50 -f

# Testar
curl -X POST http://localhost:8000/analyze \
  -H 'Content-Type: application/json' \
  -d '{"regulatory_text":"RESOLU√á√ÉO BCB N¬∫ 789/2024 - Estabelece regras para valida√ß√£o de chaves Pix","repo_path":"/app/fake_pix_repo"}'

‚úÖ RESULTADO FINAL:
-------------------
Todos os 6 agentes funcionando (100%)
Pipeline completo de an√°lise regulat√≥ria operacional
