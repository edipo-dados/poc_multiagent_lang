
INSERT INTO embeddings (file_path, content, embedding)
VALUES ('api/endpoints.py', '"""FastAPI endpoints for Pix service."""

from typing import List
from uuid import UUID

from fastapi import APIRouter, HTTPException, status

from fake_pix_repo.api.schemas import (
    AccountCreate,
    AccountResponse,
    ErrorResponse,
    PixKeyCreate,
    PixKeyResponse,
    TransactionCreate,
    TransactionResponse,
)
from fake_pix_repo.domain.models import Account, Pix, Transaction
from fake_pix_repo.domain.validators import validate_pix_key, validate_transaction_amount

# Create router
router = APIRouter(prefix="/api/v1", tags=["pix"])

# In-memory storage (for demonstration purposes)
# In a real application, this would be replaced with database operations
accounts_db: dict[UUID, Account] = {}
pix_keys_db: dict[str, Pix] = {}
transactions_db: dict[UUID, Transaction] = {}


@router.post(
    "/accounts",
    response_model=AccountResponse,
    status_code=status.HTTP_201_CREATED,
    responses={400: {"model": ErrorResponse}},
)
async def create_account(account_data: AccountCreate) -> AccountResponse:
    """Create a new bank account.
    
    Args:
        account_data: Account creation data
        
    Returns:
        Created account information
        
    Raises:
        HTTPException: If account with same document already exists
    """
    # Check if account with same document already exists
    # In Brazil, each CPF/CNPJ can only have one account per bank
    for account in accounts_db.values():
        if account.holder_document == account_data.holder_document:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail=f"Account with document {account_data.holder_document} already exists"
            )
    
    # Create new account with auto-generated UUID
    account = Account(
        account_number=account_data.account_number,
        agency=account_data.agency,
        bank_code=account_data.bank_code,
        holder_name=account_data.holder_name,
        holder_document=account_data.holder_document,
        balance=account_data.initial_balance,
    )
    
    # Store in in-memory database (would be DB operation in production)
    accounts_db[account.id] = account
    
    return AccountResponse(
        id=account.id,
        account_number=account.account_number,
        agency=account.agency,
        bank_code=account.bank_code,
        holder_name=account.holder_name,
        holder_document=account.holder_document,
        balance=account.balance,
        created_at=account.created_at,
    )


@router.get(
    "/accounts/{account_id}",
    response_model=AccountResponse,
    responses={404: {"model": ErrorResponse}},
)
async def get_account(account_id: UUID) -> AccountResponse:
    """Get account by ID.
    
    Args:
        account_id: Account UUID
        
    Returns:
        Account information
        
    Raises:
        HTTPException: If account not found
    """
    account = accounts_db.get(account_id)
    if not account:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Account {account_id} not found"
        )
    
    return AccountResponse(
        id=account.id,
        account_number=account.account_number,
        agency=account.agency,
        bank_code=account.bank_code,
        holder_name=account.holder_name,
        holder_document=account.holder_document,
        balance=account.balance,
        created_at=account.created_at,
    )


@router.post(
    "/pix",
    response_model=PixKeyResponse,
    status_code=status.HTTP_201_CREATED,
    responses={400: {"model": ErrorResponse}, 404: {"model": ErrorResponse}},
)
async def create_pix_key(pix_data: PixKeyCreate) -> PixKeyResponse:
    """Create a new Pix key registration.
    
    Args:
        pix_data: Pix key creation data
        
    Returns:
        Created Pix key information
        
    Raises:
        HTTPException: If validation fails or account not found
    """
    # Validate account exists before creating Pix key
    # This ensures referential integrity
    account = accounts_db.get(pix_data.account_id)
    if not account:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Account {pix_data.account_id} not found"
        )
    
    # Validate Pix key format based on key type
    # Each key type has specific format requirements (CPF, email, phone, etc.)
    is_valid, error_msg = validate_pix_key(pix_data.key, pix_data.key_type)
    if not is_valid:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=error_msg
        )
    
    # Check if key already exists
    # Each Pix key must be unique across the entire system
    if pix_data.key in pix_keys_db:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=f"Pix key {pix_data.key} already registered"
        )
    
    # Create new Pix key with auto-generated UUID
    pix = Pix(
        key=pix_data.key,
        key_type=pix_data.key_type,
        account_id=pix_data.account_id,
    )
    
    # Store in in-memory database (would be DB operation in production)
    pix_keys_db[pix.key] = pix
    
    return PixKeyResponse(
        id=pix.id,
        key=pix.key,
        key_type=pix.key_type,
        account_id=pix.account_id,
        created_at=pix.created_at,
        is_active=pix.is_active,
    )


@router.get(
    "/pix/{pix_key}",
    response_model=PixKeyResponse,
    responses={404: {"model": ErrorResponse}},
)
async def get_pix_key(pix_key: str) -> PixKeyResponse:
    """Get Pix key information.
    
    Args:
        pix_key: Pix key value
        
    Returns:
        Pix key information
        
    Raises:
        HTTPException: If Pix key not found
    """
    pix = pix_keys_db.get(pix_key)
    if not pix:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Pix key {pix_key} not found"
        )
    
    return PixKeyResponse(
        id=pix.id,
        key=pix.key,
        key_type=pix.key_type,
        account_id=pix.account_id,
        created_at=pix.created_at,
        is_active=pix.is_active,
    )


@router.post(
    "/transactions",
    response_model=TransactionResponse,
    status_code=status.HTTP_201_CREATED,
    responses={400: {"model": ErrorResponse}, 404: {"model": ErrorResponse}},
)
async def create_transaction(transaction_data: TransactionCreate) -> TransactionResponse:
    """Create a new Pix transaction.
    
    Args:
        transaction_data: Transaction creation data
        
    Returns:
        Created transaction information
        
    Raises:
        HTTPException: If validation fails or keys not found
    """
    # Validate transaction amount against regulatory limits
    # Ensures compliance with Pix transaction rules
    is_valid, error_msg = validate_transaction_amount(transaction_data.amount)
    if not is_valid:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=error_msg
        )
    
    # Validate sender Pix key exists
    # Both sender and receiver must have registered Pix keys
    sender_pix = pix_keys_db.get(transaction_data.sender_key)
    if not sender_pix:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Sender Pix key {transaction_data.sender_key} not found"
        )
    
    # Validate receiver Pix key exists
    receiver_pix = pix_keys_db.get(transaction_data.receiver_key)
    if not receiver_pix:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Receiver Pix key {transaction_data.receiver_key} not found"
        )
    
    # Create new transaction with PENDING status
    # In a real system, this would trigger payment processing
    transaction = Transaction(
        sender_key=transaction_data.sender_key,
        receiver_key=transaction_data.receiver_key,
        amount=transaction_data.amount,
        description=transaction_data.description or "",
    )
    
    # Store in in-memory database (would be DB operation in production)
    transactions_db[transaction.id] = transaction
    
    return TransactionResponse(
        id=transaction.id,
        sender_key=transaction.sender_key,
        receiver_key=transaction.receiver_key,
        amount=transaction.amount,
        description=transaction.description,
        status=transaction.status,
        created_at=transaction.created_at,
        completed_at=transaction.completed_at,
    )


@router.get(
    "/transactions/{transaction_id}",
    response_model=TransactionResponse,
    responses={404: {"model": ErrorResponse}},
)
async def get_transaction(transaction_id: UUID) -> TransactionResponse:
    """Get transaction by ID.
    
    Args:
        transaction_id: Transaction UUID
        
    Returns:
        Transaction information
        
    Raises:
        HTTPException: If transaction not found
    """
    transaction = transactions_db.get(transaction_id)
    if not transaction:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Transaction {transaction_id} not found"
        )
    
    return TransactionResponse(
        id=transaction.id,
        sender_key=transaction.sender_key,
        receiver_key=transaction.receiver_key,
        amount=transaction.amount,
        description=transaction.description,
        status=transaction.status,
        created_at=transaction.created_at,
        completed_at=transaction.completed_at,
    )


@router.get(
    "/transactions",
    response_model=List[TransactionResponse],
)
async def list_transactions() -> List[TransactionResponse]:
    """List all transactions.
    
    Returns:
        List of all transactions
    """
    return [
        TransactionResponse(
            id=transaction.id,
            sender_key=transaction.sender_key,
            receiver_key=transaction.receiver_key,
            amount=transaction.amount,
            description=transaction.description,
            status=transaction.status,
            created_at=transaction.created_at,
            completed_at=transaction.completed_at,
        )
        for transaction in transactions_db.values()
    ]
', '[-0.08258181810379028,0.013506290502846241,-0.09804311394691467,-0.0032700577285140753,-0.07293027639389038,-0.07919459789991379,0.02966882847249508,0.01088737789541483,-0.01560044102370739,-0.01934085786342621,0.06057204306125641,-0.004063839092850685,0.10196680575609207,-0.04043621942400932,0.0134159866720438,-0.012331339530646801,-0.024733301252126694,-0.01610373705625534,0.025054700672626495,-0.0017702033510431647,0.019876237958669662,0.011942310258746147,-0.014135868288576603,0.049846235662698746,-0.08796782046556473,-0.07444155216217041,0.02280792035162449,0.025208966806530952,0.023998232558369637,-0.023689186200499535,0.08978051692247391,0.06091965362429619,-0.11895801872015,-0.022068100050091743,0.0423148088157177,0.11048354208469391,0.02729780040681362,-0.09691968560218811,0.06395070254802704,-0.00377062289044261,0.12845271825790405,-0.0401148796081543,-0.04443466663360596,-0.02548454888164997,-0.0004025236121378839,-0.0031217364594340324,0.002487725345417857,0.020468145608901978,-0.009801026433706284,-0.03442142531275749,-0.035576775670051575,0.037753306329250336,-0.0079517075791955,0.03075615130364895,-0.009230488911271095,0.041700758039951324,-0.0400228425860405,0.03837418556213379,-0.05209159478545189,-0.06492359191179276,-0.01789393275976181,-0.03666442260146141,0.13083703815937042,-0.0487259216606617,-0.10781993716955185,0.01611742377281189,-0.05337301269173622,-0.0788627341389656,0.07951521873474121,-0.06993987411260605,-0.027248410508036613,0.024964414536952972,-0.1859365701675415,0.02783123590052128,-0.020505327731370926,0.028789978474378586,0.015643524006009102,-0.018761686980724335,-0.07364796847105026,-0.03842682018876076,-0.04193631559610367,-0.0796467661857605,0.024392230436205864,0.07515669614076614,0.002206489909440279,0.002281480934470892,0.04562126472592354,0.00423381058499217,-0.004471637308597565,-0.01670830324292183,0.040240976959466934,-0.0010213246569037437,0.02540201134979725,-0.062485095113515854,0.0806446522474289,0.00416411180049181,-0.02527555078268051,-0.02876649983227253,-0.018092583864927292,0.01207579392939806,0.026369426399469376,-0.05954325571656227,-0.021321827545762062,0.028794340789318085,0.03473615273833275,0.002590218558907509,0.03533942997455597,-0.032016571611166,-0.050351276993751526,0.016606902703642845,-0.00799038540571928,0.06253066658973694,-0.02668050117790699,-0.01716449484229088,-0.016329608857631683,0.1284233033657074,-0.015396878123283386,-0.028105277568101883,-0.0017196459230035543,-0.027452530339360237,0.006759626790881157,-0.005281010176986456,-0.012910783290863037,0.038143713027238846,-0.010629321448504925,-0.06767807900905609,-0.015692541375756264,5.514570199389704e-33,-0.07705767452716827,0.021039294078946114,0.015879342332482338,-0.045074623078107834,-0.0013802973553538322,0.026046494022011757,0.04299316555261612,-0.028350576758384705,-0.05622842162847519,-0.011128680780529976,-0.10644902288913727,0.08167915791273117,-0.03461989387869835,0.008220917545258999,0.04128449037671089,-0.025703856721520424,-0.027622176334261894,0.05579071491956711,0.10108970105648041,0.023788468912243843,0.08034786581993103,-0.05362708866596222,0.034921105951070786,-0.05024804174900055,0.03263897821307182,0.04460204020142555,-0.05463573336601257,-0.045210935175418854,-0.03778577595949173,-0.03774125128984451,-0.01810261979699135,-0.03702760860323906,0.06642873585224152,0.025620942935347557,0.04637697711586952,-0.03584505617618561,-0.000930013251490891,-0.021890703588724136,-0.12153077870607376,-0.059966884553432465,-0.02288261614739895,-0.00042948234477080405,-0.04314642399549484,0.053135938942432404,-0.07321193069219589,0.018699567764997482,-0.06599094718694687,0.037808630615472794,0.07421785593032837,0.004497065674513578,-0.01578923873603344,0.011463548988103867,0.029210247099399567,-0.062499552965164185,-0.0500011071562767,-0.0664956346154213,0.012176288291811943,-0.012622945941984653,0.019174417480826378,-0.005673655308783054,-0.010458743199706078,-0.005557970609515905,-0.03067365288734436,0.06658506393432617,0.018262987956404686,0.004851519130170345,0.06245823949575424,0.04591617360711098,0.009839245118200779,0.08097071200609207,-0.01708562672138214,0.07725103199481964,-0.036407459527254105,0.020505089312791824,0.011331149376928806,-0.10185843706130981,0.03199964761734009,-0.019316822290420532,-0.008401043713092804,0.0018908128840848804,0.05889802798628807,-0.013531728647649288,-0.08373010158538818,0.08992505073547363,-0.0621848963201046,0.03243939206004143,0.07205825299024582,0.017012735828757286,-0.002118535805493593,9.431852959096432e-05,-0.03928835690021515,-0.020698873326182365,0.030458534136414528,0.01972493901848793,-0.0729980319738388,-7.397038444207193e-33,0.004375711549073458,-0.06394661962985992,0.053038496524095535,0.03323787823319435,-0.030408253893256187,-0.044965676963329315,0.07779981195926666,0.048507463186979294,0.041215814650058746,-0.010747493244707584,-0.01962742768228054,-0.005454952362924814,0.03150061517953873,-0.012495665811002254,0.07070877403020859,-0.03177306801080704,-0.05631522834300995,-0.04223020747303963,0.010611400939524174,0.012172881513834,-0.0993211641907692,0.07642295211553574,-0.03560224175453186,0.006366475485265255,-0.10873033851385117,0.04591844230890274,0.02626904472708702,0.013747640885412693,-0.08699965476989746,-0.03050355613231659,-0.03230602666735649,0.023190457373857498,-0.02206234447658062,0.024925431236624718,-0.044673144817352295,-0.007883612997829914,0.025214659050107002,0.1063285768032074,0.09375105053186417,-0.038991834968328476,0.07826457917690277,-0.044265471398830414,-0.03395948186516762,0.033896367996931076,-0.009981095790863037,-0.04828968271613121,-0.0071652852930128574,0.01620916835963726,-0.0772361010313034,0.05601024627685547,-0.006472426000982523,0.008991762064397335,0.022137494757771492,0.07781971991062164,0.04191086068749428,0.036064207553863525,0.05453318729996681,-0.04965323954820633,0.040660884231328964,-0.06424889713525772,-0.02595042809844017,-0.06949283182621002,-0.009936792775988579,0.1842278093099594,0.025696925818920135,-0.022082172334194183,-0.042498279362916946,-0.11612201482057571,-0.024653512984514236,-0.021883921697735786,-0.0016971209552139044,0.00039614623528905213,-0.022534407675266266,0.0861857533454895,0.10336992889642715,-0.013506735675036907,-0.10209236294031143,0.033702656626701355,0.0166921466588974,0.05107234790921211,-0.07589846104383469,-0.04899410530924797,0.03492739424109459,-0.014242339879274368,-0.014446779154241085,-0.1212957352399826,0.018550876528024673,0.031003519892692566,0.048383716493844986,0.03395068272948265,0.002103575970977545,-0.0039465539157390594,-0.015871267765760422,-0.030653079971671104,-0.04683978855609894,-5.566581506855073e-08,-0.0730649083852768,0.03536636009812355,0.0030219662003219128,0.08813630789518356,-0.008182372897863388,0.014511985704302788,0.03984597697854042,-0.017225544899702072,0.014862353913486004,-0.008256347849965096,-0.020488101989030838,-0.017032725736498833,-0.05220033973455429,-0.03653256595134735,0.03127904608845711,0.041285496205091476,-0.038588762283325195,0.029655026271939278,0.03354538604617119,0.008711634203791618,-0.08452380448579788,0.04668760299682617,0.04672585800290108,-0.10102586448192596,0.011999969370663166,0.07220388948917389,0.10012313723564148,0.08834543824195862,-0.06567257642745972,-0.035127464681863785,-0.0003371113270986825,-0.05065540224313736,0.017432481050491333,0.0009537360747344792,-0.040679287165403366,0.07583408057689667,0.012495174072682858,0.06949873268604279,0.045526694506406784,0.03222604840993881,-0.12179911136627197,0.03623171150684357,-0.04820295050740242,-0.03953373804688454,0.0550161637365818,0.020849302411079407,-0.06778363138437271,0.020487533882260323,0.12637242674827576,0.03671025484800339,-0.03712356463074684,-0.029644150286912918,0.0665474385023117,0.0014015252236276865,-0.05556131526827812,0.03183677792549133,-0.05799183249473572,-0.0978035256266594,0.028589170426130295,-0.026114990934729576,0.06378373503684998,0.07964909076690674,0.0826299637556076,-0.025767313316464424]'::vector)
ON CONFLICT (file_path) 
DO UPDATE SET 
    content = EXCLUDED.content,
    embedding = EXCLUDED.embedding,
    updated_at = NOW();


INSERT INTO embeddings (file_path, content, embedding)
VALUES ('api/schemas.py', '"""Pydantic schemas for API request/response models."""

from datetime import datetime
from decimal import Decimal
from typing import Optional
from uuid import UUID

from pydantic import BaseModel, Field, validator

from fake_pix_repo.domain.models import PixKeyType, TransactionStatus


# Account Schemas
class AccountCreate(BaseModel):
    """Schema for creating a new account."""
    
    account_number: str = Field(..., min_length=1, max_length=20)
    agency: str = Field(..., min_length=1, max_length=10)
    bank_code: str = Field(..., min_length=1, max_length=10)
    holder_name: str = Field(..., min_length=1, max_length=255)
    holder_document: str = Field(..., min_length=1, max_length=20)
    initial_balance: Decimal = Field(default=Decimal("0.00"), ge=0)


class AccountResponse(BaseModel):
    """Schema for account response."""
    
    id: UUID
    account_number: str
    agency: str
    bank_code: str
    holder_name: str
    holder_document: str
    balance: Decimal
    created_at: datetime
    
    class Config:
        orm_mode = True


# Pix Key Schemas
class PixKeyCreate(BaseModel):
    """Schema for creating a new Pix key."""
    
    key: str = Field(..., min_length=1, max_length=255)
    key_type: PixKeyType
    account_id: UUID
    
    @validator(''key'')
    def validate_key_format(cls, v, values):
        """Validate key format based on key_type."""
        # Basic validation - detailed validation happens in the service layer
        if not v or not v.strip():
            raise ValueError("Key cannot be empty")
        return v.strip()


class PixKeyResponse(BaseModel):
    """Schema for Pix key response."""
    
    id: UUID
    key: str
    key_type: PixKeyType
    account_id: UUID
    created_at: datetime
    is_active: bool
    
    class Config:
        orm_mode = True


# Transaction Schemas
class TransactionCreate(BaseModel):
    """Schema for creating a new transaction."""
    
    sender_key: str = Field(..., min_length=1, max_length=255)
    receiver_key: str = Field(..., min_length=1, max_length=255)
    amount: Decimal = Field(..., gt=0)
    description: Optional[str] = Field(None, max_length=500)
    
    @validator(''amount'')
    def validate_amount(cls, v):
        """Validate amount has at most 2 decimal places."""
        if v.as_tuple().exponent < -2:
            raise ValueError("Amount cannot have more than 2 decimal places")
        return v


class TransactionResponse(BaseModel):
    """Schema for transaction response."""
    
    id: UUID
    sender_key: str
    receiver_key: str
    amount: Decimal
    description: Optional[str]
    status: TransactionStatus
    created_at: datetime
    completed_at: Optional[datetime]
    
    class Config:
        orm_mode = True


# Error Schemas
class ErrorResponse(BaseModel):
    """Schema for error responses."""
    
    error: str
    detail: Optional[str] = None


# Success Schemas
class SuccessResponse(BaseModel):
    """Schema for generic success responses."""
    
    message: str
    data: Optional[dict] = None
', '[-0.020673081278800964,0.02475389838218689,-0.09225160628557205,-0.04538282752037048,-0.09619680047035217,-0.024826493114233017,0.009609665721654892,0.08061099797487259,0.007800491992384195,-0.004347002599388361,0.06475581228733063,-0.08478697389364243,0.05272173509001732,-0.029295679181814194,0.04591285064816475,-0.026791974902153015,-0.0831986665725708,-0.030361682176589966,0.017806358635425568,0.03334775194525719,0.08838091790676117,-0.030527407303452492,-0.024318911135196686,0.024114146828651428,-0.06282505393028259,-0.01381045114248991,0.0520821139216423,0.0649300068616867,-0.05383734032511711,-0.01264948584139347,0.021650681272149086,0.052912387996912,0.021318990737199783,-0.005354203749448061,0.09072206169366837,0.08837117999792099,0.011432222090661526,-0.024150261655449867,0.03046136535704136,0.016103701665997505,0.0056870682165026665,-0.09917178004980087,0.07664495706558228,-0.02399587631225586,0.0016157561913132668,0.015754634514451027,-0.029312098398804665,0.06381934881210327,0.002916058525443077,0.0006605179514735937,-0.03230462223291397,0.0031140982173383236,0.038107167929410934,-0.029827332124114037,-0.03581366688013077,0.02308374084532261,-0.031284429132938385,-0.04115019738674164,-0.05826174095273018,-0.16432695090770721,-0.011649279855191708,0.03654249757528305,0.024551309645175934,0.008698252029716969,-0.07840172201395035,0.00846046768128872,-0.08422349393367767,-0.002148587489500642,0.005628038197755814,-0.03037712164223194,-0.01735560968518257,-0.0328165739774704,-0.20195025205612183,-0.00756856519728899,-0.010075049474835396,0.04108356684446335,-0.0003884943434968591,0.00933409109711647,0.0030229068361222744,-0.08679860830307007,-0.05024440586566925,-0.045127954334020615,0.0001326217461610213,0.06639552861452103,0.04157267510890961,-0.01339113898575306,0.07737167179584503,0.07920817285776138,-0.006591105833649635,-0.007564548868685961,0.04910306632518768,0.0695628821849823,0.05156422033905983,-0.04935692250728607,0.019048940390348434,0.015002510510385036,0.008649195544421673,-0.01195908896625042,0.02519097924232483,0.041042931377887726,0.05037485435605049,0.002663665683940053,-0.005895522888749838,0.012559766881167889,-0.010487014427781105,-0.0071524945087730885,0.05951261520385742,0.006611524149775505,-0.037534069269895554,-0.06440195441246033,-0.024510206654667854,0.04173237830400467,-0.020854096859693527,-0.08605877310037613,0.07452239841222763,0.12325950711965561,-0.067457415163517,-0.02661609649658203,-0.007125441916286945,-0.00580658670514822,0.09553641080856323,0.05952376499772072,-0.07261481136083603,0.035355277359485626,-0.05173509940505028,0.03418217599391937,-0.013476628810167313,5.37858570680872e-33,-0.0834866538643837,0.011981937102973461,0.041713688522577286,-0.037561073899269104,-0.03964363411068916,0.036209169775247574,0.02161635272204876,0.011642036959528923,-0.07622915506362915,0.002244077855721116,-0.06550892442464828,0.013104045763611794,-0.023921217769384384,-0.04293476790189743,-0.04168974980711937,0.010862334631383419,-0.060953374952077866,0.08770696073770523,0.08490221947431564,0.06680231541395187,0.06386378407478333,-0.08584616333246231,0.021276500076055527,0.03339311480522156,0.06726041436195374,0.025990338996052742,-0.10022333264350891,-0.036235611885786057,-0.064969003200531,-0.01911449059844017,0.006231362000107765,-0.057478632777929306,0.019745150581002235,-0.05525125563144684,0.04462820291519165,-0.021816086024045944,0.028190070763230324,-0.00823743175715208,-0.04217592254281044,-0.06333278864622116,-0.048364486545324326,-0.011471421457827091,0.05348249897360802,0.0026063669938594103,-0.03180374950170517,0.02252991683781147,0.0029570632614195347,0.073575958609581,0.006473558489233255,0.05439160764217377,0.0035355244763195515,-0.02633657678961754,-0.009412403218448162,-9.852387302089483e-05,-0.07395103573799133,-0.04947293922305107,-0.0225669052451849,0.03590378910303116,-0.05433795228600502,-0.07431912422180176,0.0786314606666565,0.03397713229060173,-0.03809722512960434,-0.02675974741578102,-0.010816044174134731,0.06138276308774948,0.05762472376227379,0.03571554645895958,0.014820564538240433,0.06342121958732605,-0.016919802874326706,0.0867922380566597,-0.06200805678963661,0.02562352642416954,0.01814921759068966,-0.09257485717535019,0.14449940621852875,-0.010703491047024727,-0.029627235606312752,0.03462868928909302,-0.002208914142102003,0.015711506828665733,-0.0411822535097599,0.058279089629650116,-0.07926224172115326,0.03060802072286606,0.15032854676246643,-0.013584364205598831,-0.03114655800163746,-0.057632606476545334,-0.03825538232922554,-0.09669477492570877,-0.006114725023508072,0.03515167534351349,-0.003541193902492523,-6.486127300603863e-33,-0.01838153973221779,-0.07984128594398499,0.043553609400987625,-0.006250320002436638,0.04166306182742119,-0.018340280279517174,0.0871482789516449,0.05067168176174164,0.042543333023786545,0.028620589524507523,0.024275708943605423,-0.015627166256308556,-0.010921825654804707,-0.01644907146692276,0.11879613250494003,-0.018617888912558556,-0.055442653596401215,-0.06342978030443192,0.001973408740013838,0.03448185697197914,-0.011137077584862709,0.0903925895690918,-0.037018001079559326,0.04110424965620041,-0.01623881421983242,0.06810976564884186,-0.056385815143585205,-0.019859081134200096,-0.06707072257995605,-0.012580501846969128,-0.06966827809810638,0.006608171854168177,-0.06307855993509293,0.11009793728590012,-0.10056254267692566,-0.07079171389341354,0.05277871713042259,0.058148887008428574,0.05420764908194542,0.04085032641887665,0.028863273561000824,0.01711648516356945,-0.07457917928695679,0.00849570520222187,0.04644714295864105,-0.010618874803185463,0.047327280044555664,0.030624590814113617,-0.0045416890643537045,-0.007172723300755024,-0.07815959304571152,0.014304634183645248,-0.027519671246409416,0.047741055488586426,-0.03411904349923134,0.05529235675930977,0.07007145881652832,-0.048276256769895554,0.03308287635445595,-0.07749772816896439,-0.10207919776439667,-0.01899588480591774,-0.004567400552332401,0.12776368856430054,0.03894038498401642,-0.08202224969863892,-0.02709634229540825,-0.06168287619948387,-0.03673407435417175,-0.07128371298313141,-0.01544193271547556,0.003611848223954439,0.00625254912301898,0.029912088066339493,-0.0010028468677774072,0.051154110580682755,-0.11966192722320557,-0.0008288074168376625,0.001364745432510972,0.04313741251826286,-0.05390433222055435,0.007382165174931288,0.07510938495397568,0.06561131775379181,-0.0031024881172925234,-0.07839546352624893,0.028399551287293434,0.009440788999199867,0.005409987643361092,-0.017248813062906265,-0.025281770154833794,-0.011682185344398022,-0.007246654946357012,0.02829309180378914,-0.023931438103318214,-5.765968680293554e-08,-0.041188888251781464,0.01973043754696846,0.020965181291103363,0.04902911186218262,0.014916517771780491,0.00916592963039875,-0.004821106791496277,-0.07997505366802216,0.043987490236759186,-0.01360253058373928,0.045645590871572495,-0.015556594356894493,-0.02777513489127159,-0.06835126876831055,-0.002309837145730853,0.028154494240880013,-0.054593849927186966,-0.0289138350635767,0.0016455268487334251,-0.028256820514798164,-0.03213346377015114,-0.023661738261580467,-0.040549591183662415,-0.08913629502058029,-0.013101525604724884,-0.015013739466667175,0.011221349239349365,0.11851959675550461,0.014574645087122917,-0.06110241264104843,0.050841137766838074,-0.005692780949175358,0.03665994852781296,-0.03145557641983032,0.025893360376358032,0.04216710105538368,0.03392617404460907,0.0584588386118412,0.0008218032889999449,0.028215045109391212,-0.07290652394294739,0.012416982091963291,-0.13541294634342194,-0.036365851759910583,0.10113941878080368,-0.007401572540402412,-0.0475945770740509,-0.020665830001235008,0.14453107118606567,0.02628660388290882,-0.02411024458706379,-0.009205151349306107,0.07507745921611786,0.008424567990005016,-0.06262153387069702,0.02453707717359066,-0.010962341912090778,0.004794179927557707,-0.01513434574007988,-0.06087125092744827,0.041651755571365356,0.09134602546691895,0.06541750580072403,-0.025081751868128777]'::vector)
ON CONFLICT (file_path) 
DO UPDATE SET 
    content = EXCLUDED.content,
    embedding = EXCLUDED.embedding,
    updated_at = NOW();


INSERT INTO embeddings (file_path, content, embedding)
VALUES ('domain/models.py', '"""Domain models for Pix service.

This module contains the core domain entities for the Pix payment system.
"""

from dataclasses import dataclass, field
from datetime import datetime
from decimal import Decimal
from enum import Enum
from typing import Optional
from uuid import UUID, uuid4


class PixKeyType(str, Enum):
    """Types of Pix keys supported."""
    CPF = "cpf"
    CNPJ = "cnpj"
    EMAIL = "email"
    PHONE = "phone"
    RANDOM = "random"


class TransactionStatus(str, Enum):
    """Status of a Pix transaction."""
    PENDING = "pending"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


@dataclass
class Account:
    """Represents a bank account in the Pix system."""
    
    id: UUID = field(default_factory=uuid4)
    account_number: str = ""
    agency: str = ""
    bank_code: str = ""
    holder_name: str = ""
    holder_document: str = ""
    balance: Decimal = Decimal("0.00")
    created_at: datetime = field(default_factory=datetime.utcnow)
    
    def __post_init__(self):
        """Validate account data after initialization."""
        if isinstance(self.balance, (int, float)):
            self.balance = Decimal(str(self.balance))


@dataclass
class Pix:
    """Represents a Pix key registration."""
    
    id: UUID = field(default_factory=uuid4)
    key: str = ""
    key_type: PixKeyType = PixKeyType.RANDOM
    account_id: UUID = field(default_factory=uuid4)
    created_at: datetime = field(default_factory=datetime.utcnow)
    is_active: bool = True


@dataclass
class Transaction:
    """Represents a Pix transaction."""
    
    id: UUID = field(default_factory=uuid4)
    sender_key: str = ""
    receiver_key: str = ""
    amount: Decimal = Decimal("0.00")
    description: str = ""
    status: TransactionStatus = TransactionStatus.PENDING
    created_at: datetime = field(default_factory=datetime.utcnow)
    completed_at: Optional[datetime] = None
    
    def __post_init__(self):
        """Validate transaction data after initialization."""
        if isinstance(self.amount, (int, float)):
            self.amount = Decimal(str(self.amount))
', '[-0.05090246722102165,-0.0037728026509284973,-0.07907093316316605,-0.06552943587303162,-0.0985104888677597,-0.007774220313876867,0.04727105423808098,0.01646966114640236,0.05297378823161125,-0.001526801148429513,0.05864718556404114,-0.03643424063920975,0.08177356421947479,-0.07211965322494507,0.018871556967496872,-0.06993319094181061,-0.03235112875699997,-0.037365421652793884,-0.000780190690420568,0.004262953065335751,0.07079852372407913,0.0010498183546587825,-0.035519879311323166,-0.016708768904209137,-0.05993609130382538,-0.026164082810282707,0.09146353602409363,0.03286192938685417,-0.036188755184412,-0.01576927863061428,0.024505270645022392,0.08458742499351501,0.014166128821671009,-0.027193035930395126,0.08330312371253967,0.034484270960092545,0.06190304085612297,-0.04741101339459419,0.0052751353941857815,-0.034008342772722244,0.048400476574897766,-0.07199949771165848,0.07371450215578079,-0.04847424477338791,0.006208848673850298,-0.004713339731097221,-0.03414330258965492,-0.008890951983630657,-0.005788752343505621,0.00905311293900013,0.010836896486580372,-0.0016986291157081723,0.04208781570196152,0.03865252807736397,-0.013709938153624535,0.062223728746175766,-0.0075489613227546215,-0.013258393853902817,-0.010017476044595242,-0.10924539715051651,-0.016611328348517418,0.014604559168219566,-0.0093305679038167,-0.005071512423455715,-0.04005928337574005,0.005042721051722765,-0.06863487511873245,-0.04170508310198784,-0.007287569809705019,-0.055243030190467834,0.0041602617129683495,-0.031538307666778564,-0.16216671466827393,0.018409855663776398,-0.01998504437506199,0.09073714166879654,-0.009687107987701893,-0.014853080734610558,-0.021604139357805252,-0.08467420935630798,-0.08530379831790924,-0.04472864046692848,0.044059958308935165,0.04779442027211189,0.03699629008769989,0.015936126932501793,0.07167120277881622,0.05277632176876068,-0.03451990708708763,-0.01143147423863411,0.01998366042971611,0.08668607473373413,0.06507109850645065,-0.053617414087057114,0.02595285326242447,-0.026385873556137085,-0.03376980125904083,0.017228472977876663,0.025864863768219948,0.008879624307155609,0.04110700637102127,0.031522754579782486,-0.014250124804675579,0.03388495370745659,0.018190007656812668,-0.07474683970212936,0.026512032374739647,0.019656971096992493,-0.04105604439973831,-0.0931658148765564,-0.08356571942567825,0.0006586162489838898,-0.020546581596136093,-0.09743882715702057,0.01924165152013302,0.061741508543491364,-0.00794197153300047,-0.04846112057566643,0.0018184069776907563,-0.041002485901117325,0.06613508611917496,0.0334189236164093,-0.11923683434724808,0.016110476106405258,-0.037513382732868195,0.014364005997776985,-0.02300827018916607,9.739276325093866e-33,-0.06147608160972595,0.0026542756240814924,0.02938690036535263,-0.040757447481155396,-0.01401616632938385,0.01987001858651638,0.006066447123885155,-0.056437984108924866,-0.06748419255018234,0.030942171812057495,-0.1097305417060852,0.07171923667192459,-0.037141457200050354,-0.06378431618213654,-0.04902893304824829,-0.005798915401101112,0.002774106804281473,0.06734365224838257,0.13159263134002686,0.09467531740665436,0.09912962466478348,-0.019960083067417145,0.046860311180353165,0.007283282931894064,0.05045030266046524,0.03916444629430771,-0.04563269019126892,-0.09154605120420456,0.011975912377238274,-0.01791454292833805,0.009322043508291245,-0.04074631631374359,0.045802224427461624,0.019152618944644928,0.043503403663635254,0.0014350293204188347,0.06321388483047485,0.02222972735762596,-0.07545449584722519,-0.04365622252225876,-0.03490633890032768,-0.014139827340841293,0.003264593193307519,0.009074224159121513,-0.07140615582466125,-0.002561439061537385,0.029326580464839935,-0.01888084225356579,0.076979860663414,0.03686443716287613,0.03522348031401634,0.004735402297228575,0.03102084808051586,-0.07810764014720917,-0.07290081679821014,-0.06855355948209763,0.053426507860422134,0.032779280096292496,-0.07007994502782822,-0.11134279519319534,0.011220499873161316,0.018628932535648346,-0.01639372855424881,-0.025470564141869545,0.019007625058293343,0.0287934560328722,0.06169098615646362,-0.018375443294644356,-0.00016794732073321939,0.04588347300887108,-0.04561154544353485,0.11553461104631424,0.012879306450486183,0.02134961076080799,0.07451731711626053,-0.09868472814559937,0.05719752237200737,-0.03063955157995224,-0.03921091929078102,0.03320097178220749,-0.007716434076428413,-0.040793225169181824,-0.04708492010831833,0.05070418864488602,-0.021349063143134117,0.028993219137191772,0.1112169474363327,0.05138431489467621,-0.050136107951402664,-0.08313259482383728,-0.06662973016500473,-0.06532357633113861,0.027286676689982414,0.07259822636842728,-0.027070125564932823,-1.0605357052892711e-32,-0.01963474415242672,-0.045265793800354004,-0.019952718168497086,0.03997129201889038,0.020772676914930344,0.010234260931611061,0.04203140735626221,0.0625714585185051,0.06206744164228439,0.0033833603374660015,0.07532484084367752,-0.03973953053355217,0.04650811105966568,0.018363013863563538,0.08039426803588867,-0.007321276236325502,-0.05183567851781845,-0.0837482437491417,-0.070318803191185,0.005286503583192825,-0.09870760142803192,0.07436960935592651,-0.029601698741316795,0.0472681000828743,-0.049984753131866455,0.08151517808437347,-0.02119661681354046,-0.018505074083805084,-0.06631606817245483,-0.06819871813058853,-0.0676872506737709,-0.011363131925463676,-0.05852366238832474,0.09525548666715622,-0.08255008608102798,-0.06004229933023453,0.09320314228534698,0.05578295886516571,0.03887392207980156,-0.0038511401508003473,-0.033971719443798065,0.015934234485030174,-0.05982600525021553,0.02769072726368904,0.024308016523718834,-0.04791367053985596,0.05688538774847984,0.05179763585329056,-0.03274127468466759,0.06962738931179047,-0.057096339762210846,-0.026622798293828964,0.041521959006786346,0.07486315071582794,0.0030563734471797943,0.040707990527153015,0.12039648741483688,-0.07007737457752228,0.016840757802128792,-0.03733959048986435,-0.07461152225732803,-0.01997579261660576,0.040775030851364136,0.1493435502052307,0.0450252965092659,-0.02253538928925991,-0.009171863086521626,-0.03266315907239914,-0.04446715861558914,-0.09066315740346909,0.01495586521923542,0.05071258544921875,-0.0617765448987484,0.029498765245079994,0.03697317838668823,0.010611649602651596,-0.059513550251722336,0.03613599017262459,0.0047708675265312195,0.05233144387602806,-0.04035734012722969,-0.007504255045205355,0.010474257171154022,0.04867233708500862,0.0008112153736874461,-0.054227665066719055,0.03317392244935036,0.008088103495538235,0.05024847388267517,-0.0550251267850399,-0.048096850514411926,-0.031820982694625854,-0.023336701095104218,0.014077944681048393,-0.08639820665121078,-5.774472811026499e-08,-0.06703656166791916,0.01011496502906084,-0.04168381541967392,0.04226476699113846,0.01975698582828045,-0.05010906234383583,-0.008099423721432686,-0.03324755281209946,0.07355552911758423,-0.045496921986341476,0.07212935388088226,-0.01475659478455782,-0.03738921880722046,-0.09975140541791916,0.021689539775252342,0.006100683007389307,-0.003291996428743005,0.0007865375373512506,0.038978565484285355,-0.005824518855661154,-0.015603485517203808,-0.04262692853808403,0.011960283853113651,-0.07851346582174301,-0.011151895858347416,-0.015501024201512337,0.039791952818632126,0.08957565575838089,0.05862470343708992,-0.004481249023228884,0.0023590049240738153,-0.02107403613626957,0.030307341367006302,-0.06464651972055435,-0.033779408782720566,0.018715912476181984,0.0526735819876194,0.03494568169116974,0.027360176667571068,0.05879729241132736,0.0026600263081490993,-0.0037141512148082256,-0.16331741213798523,-0.029438629746437073,0.05651204288005829,0.016699016094207764,-0.016750499606132507,-0.06304514408111572,0.1425313651561737,0.023026281967759132,-0.10921485722064972,0.022529812529683113,0.09698023647069931,0.005931029561907053,-0.046023376286029816,0.010512830689549446,0.021094104275107384,-0.05594344809651375,0.04728800430893898,-0.047926511615514755,0.0020694888662546873,0.04942839965224266,0.013391689397394657,0.013582390733063221]'::vector)
ON CONFLICT (file_path) 
DO UPDATE SET 
    content = EXCLUDED.content,
    embedding = EXCLUDED.embedding,
    updated_at = NOW();


INSERT INTO embeddings (file_path, content, embedding)
VALUES ('domain/validators.py', '"""Business rule validators for Pix service."""

import re
from decimal import Decimal
from typing import Tuple

from .models import PixKeyType


class ValidationError(Exception):
    """Raised when validation fails."""
    pass


def validate_cpf(cpf: str) -> bool:
    """Validate Brazilian CPF format.
    
    Args:
        cpf: CPF string (can include dots and dashes)
        
    Returns:
        True if valid, False otherwise
    """
    # Remove non-digit characters (dots, dashes, spaces)
    cpf = re.sub(r''\D'', '''', cpf)
    
    # Check length - CPF must have exactly 11 digits
    if len(cpf) != 11:
        return False
    
    # Check for known invalid CPFs (all same digit like 111.111.111-11)
    # These are technically valid by the algorithm but not issued
    if cpf == cpf[0] * 11:
        return False
    
    # Validate check digits (simplified validation)
    # In production, this should implement the full CPF validation algorithm
    return True


def validate_cnpj(cnpj: str) -> bool:
    """Validate Brazilian CNPJ format.
    
    Args:
        cnpj: CNPJ string (can include dots, dashes, and slashes)
        
    Returns:
        True if valid, False otherwise
    """
    # Remove non-digit characters (dots, dashes, slashes, spaces)
    cnpj = re.sub(r''\D'', '''', cnpj)
    
    # Check length - CNPJ must have exactly 14 digits
    if len(cnpj) != 14:
        return False
    
    # Check for known invalid CNPJs (all same digit like 00.000.000/0000-00)
    # These are technically valid by the algorithm but not issued
    if cnpj == cnpj[0] * 14:
        return False
    
    # Validate check digits (simplified validation)
    # In production, this should implement the full CNPJ validation algorithm
    return True


def validate_email(email: str) -> bool:
    """Validate email format.
    
    Args:
        email: Email address string
        
    Returns:
        True if valid, False otherwise
    """
    pattern = r''^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$''
    return bool(re.match(pattern, email))


def validate_phone(phone: str) -> bool:
    """Validate Brazilian phone number format.
    
    Args:
        phone: Phone number string (can include +55, parentheses, spaces, dashes)
        
    Returns:
        True if valid, False otherwise
    """
    # Remove non-digit characters (parentheses, spaces, dashes, plus sign)
    phone = re.sub(r''\D'', '''', phone)
    
    # Remove country code if present (+55 for Brazil)
    if phone.startswith(''55''):
        phone = phone[2:]
    
    # Check length (10 or 11 digits for Brazilian phones)
    # 10 digits: landline (XX) XXXX-XXXX
    # 11 digits: mobile (XX) 9XXXX-XXXX (9 is the mobile prefix)
    return len(phone) in [10, 11]


def validate_random_key(key: str) -> bool:
    """Validate random Pix key format (UUID).
    
    Args:
        key: Random key string
        
    Returns:
        True if valid, False otherwise
    """
    pattern = r''^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$''
    return bool(re.match(pattern, key.lower()))


def validate_pix_key(key: str, key_type: PixKeyType) -> Tuple[bool, str]:
    """Validate a Pix key based on its type.
    
    Args:
        key: The Pix key value
        key_type: The type of Pix key
        
    Returns:
        Tuple of (is_valid, error_message)
    """
    validators = {
        PixKeyType.CPF: (validate_cpf, "Invalid CPF format"),
        PixKeyType.CNPJ: (validate_cnpj, "Invalid CNPJ format"),
        PixKeyType.EMAIL: (validate_email, "Invalid email format"),
        PixKeyType.PHONE: (validate_phone, "Invalid phone number format"),
        PixKeyType.RANDOM: (validate_random_key, "Invalid random key format"),
    }
    
    validator, error_msg = validators.get(key_type, (lambda x: False, "Unknown key type"))
    
    if not validator(key):
        return False, error_msg
    
    return True, ""


def validate_transaction_amount(amount: Decimal) -> Tuple[bool, str]:
    """Validate transaction amount.
    
    Args:
        amount: Transaction amount
        
    Returns:
        Tuple of (is_valid, error_message)
    """
    # Minimum transaction amount: R$ 0.01 (one cent)
    # This prevents zero or negative transactions
    if amount < Decimal("0.01"):
        return False, "Transaction amount must be at least R$ 0.01"
    
    # Maximum transaction amount: R$ 100,000.00
    # This is a regulatory limit for instant Pix transactions
    if amount > Decimal("100000.00"):
        return False, "Transaction amount cannot exceed R$ 100,000.00"
    
    # Check decimal places (max 2)
    # Pix transactions use Brazilian Real (BRL) which has 2 decimal places
    # exponent of -2 means 2 decimal places (e.g., 10.50)
    # exponent of -3 would mean 3 decimal places (e.g., 10.505) - invalid
    if amount.as_tuple().exponent < -2:
        return False, "Transaction amount cannot have more than 2 decimal places"
    
    return True, ""


def validate_account_balance(balance: Decimal, withdrawal_amount: Decimal) -> Tuple[bool, str]:
    """Validate if account has sufficient balance for withdrawal.
    
    Args:
        balance: Current account balance
        withdrawal_amount: Amount to withdraw
        
    Returns:
        Tuple of (is_valid, error_message)
    """
    if balance < withdrawal_amount:
        return False, f"Insufficient balance. Available: R$ {balance}, Required: R$ {withdrawal_amount}"
    
    return True, ""
', '[-0.06313762068748474,-0.012258946895599365,-0.04770471900701523,-0.12525394558906555,-0.07971984148025513,0.007449066266417503,0.030131667852401733,0.005944510921835899,-0.0358206108212471,-0.015953095629811287,0.038447387516498566,-0.043239057064056396,0.07352276891469955,0.014669522643089294,-0.015487059019505978,-0.12961958348751068,-0.027644120156764984,0.029041560366749763,-0.029478132724761963,-0.028688620775938034,0.003334110602736473,-0.034035053104162216,-0.05103406682610512,0.022439053282141685,-0.07592620700597763,-0.029307588934898376,-0.019420022144913673,-0.0316242091357708,-0.025846246629953384,-0.023950254544615746,0.020281482487916946,0.04481221362948418,0.014708162285387516,-0.01507783867418766,0.17124533653259277,0.04618671163916588,0.04822468385100365,-0.07423743605613708,-0.006397945340722799,0.09833001345396042,-0.012799409218132496,-0.12005795538425446,0.022411348298192024,-0.021143371239304543,0.015056335367262363,0.015459331683814526,-0.03323407471179962,0.05212140828371048,0.014981462620198727,-0.075043223798275,-0.04551909491419792,0.08636854588985443,-0.017987094819545746,0.008086562156677246,0.005170735064893961,-0.05908939242362976,-0.010329502634704113,-0.0269453302025795,-0.017325587570667267,-0.10119812190532684,-0.042462680488824844,-0.021311679854989052,-0.021507173776626587,-0.04463859274983406,-0.0757245346903801,-0.02762729488313198,-0.1344529539346695,-0.1210789903998375,-0.04796433076262474,0.07011369615793228,0.0028271758928894997,0.030277082696557045,-0.08703485131263733,0.07734228670597076,-0.05417538061738014,0.09910111874341965,0.014921511523425579,-0.041438136249780655,-0.001728922943584621,-0.04317856207489967,-0.04974152892827988,-0.039224546402692795,0.08103065192699432,0.01479273196309805,0.03785792738199234,-0.050368499010801315,0.08837877959012985,0.042052678763866425,0.03870902210474014,0.050834864377975464,0.07224194705486298,0.05168355628848076,0.0311309564858675,-0.014323923736810684,0.0075163166038692,-0.01837727800011635,0.001587000209838152,0.031858474016189575,-0.04785267636179924,0.03501065820455551,-0.031110389158129692,-0.046345025300979614,0.01937880367040634,-0.09274441003799438,-0.017534183338284492,0.04517913609743118,0.07042922079563141,0.003789595328271389,0.07238143682479858,-0.06421209126710892,0.001059230649843812,-0.006391134113073349,-0.03359566256403923,-0.06604591012001038,0.036064568907022476,0.06965014338493347,0.007445267867296934,-0.025149468332529068,0.00840863399207592,-0.019606616348028183,-0.019305728375911713,-0.010212801396846771,-0.0039002448320388794,0.052811622619628906,-0.047335874289274216,0.00471463380381465,-0.05094524100422859,8.468171671879509e-33,-0.10977363586425781,0.0853021889925003,0.06480418890714645,-0.04147833213210106,-0.05688541755080223,0.03297331929206848,-0.06730399280786514,-0.008462666533887386,-0.061656005680561066,-0.05613065883517265,-0.038704026490449905,0.06274817138910294,-0.04044211283326149,-0.0107701001688838,0.05084756389260292,-0.000440490257460624,0.033039044588804245,0.000897714460734278,-0.020817823708057404,-0.011098857969045639,0.1599295735359192,-0.06799270957708359,0.004638266749680042,0.03307409957051277,0.015066779218614101,0.018650047481060028,-0.04794282838702202,-0.05706057325005531,-0.010023599490523338,0.016023581847548485,-0.046585701406002045,-0.07091783732175827,0.06386410444974899,-0.02269720658659935,-0.012892183847725391,0.02831723727285862,0.06513439118862152,-0.00032272463431581855,-0.02886975184082985,-0.01942598447203636,-0.03391220048069954,-0.01082970667630434,0.024040386080741882,0.07101503014564514,-0.023056017234921455,-0.005098388995975256,0.050429586321115494,-0.012881535105407238,0.022571131587028503,-0.017282618209719658,0.015109904110431671,0.016220474615693092,0.03619794175028801,0.008739223703742027,-0.04277908056974411,-0.026966432109475136,0.02609618566930294,0.025869503617286682,0.02643182873725891,-0.03500938415527344,0.0978863537311554,0.04260742664337158,-0.015943046659231186,0.010966203175485134,-0.007697754539549351,0.0061480202712118626,0.045111484825611115,0.02182876691222191,0.040268052369356155,0.020145615562796593,-0.061356086283922195,0.024816563352942467,-0.03294834494590759,-0.010383371263742447,0.06914882361888885,-0.11012621968984604,0.1102171540260315,0.001359105808660388,-0.016351699829101562,-0.0523049496114254,-0.006426878273487091,0.03844697028398514,0.03461125120520592,0.04537530243396759,-0.012800554744899273,-0.049647387117147446,0.04667329043149948,0.10893204808235168,-0.0930837020277977,-0.018295692279934883,-0.008855093270540237,-0.0508054681122303,0.04310408607125282,0.007963302545249462,-0.05831402167677879,-9.836307506282492e-33,-0.03530486673116684,-0.013421031646430492,0.020175402984023094,0.04923585057258606,-0.0786127969622612,-0.015368659049272537,-0.023017168045043945,-0.020039791241288185,0.02529722824692726,-0.10634022206068039,0.004215395078063011,-0.062463387846946716,0.08917257189750671,0.012316635809838772,-0.04959671571850777,-0.08051101118326187,-0.13331855833530426,0.0364726185798645,-0.06361392140388489,0.040996141731739044,-0.03097161464393139,0.024355126544833183,-0.03455642983317375,0.06918616592884064,-0.07772330194711685,0.0846812054514885,-0.031345441937446594,-0.042852893471717834,0.02219705656170845,0.02811545878648758,-0.08538289368152618,0.0530548132956028,-0.040606360882520676,0.08707889169454575,-0.05889895558357239,-0.056448038667440414,0.016997432336211205,0.06761959940195084,0.041429247707128525,0.06436076760292053,0.015202035196125507,0.0005480538820847869,-0.03711998835206032,-0.014496220275759697,-0.03692903742194176,-0.0731012150645256,0.044921912252902985,0.03424485772848129,-0.07008855789899826,-0.002289368072524667,-0.02509833686053753,0.0021252240985631943,-0.06029270589351654,0.11111031472682953,-0.041379187256097794,0.0644967257976532,-0.015570096671581268,0.04279685392975807,-0.05386542156338692,0.03977944329380989,-0.07533880323171616,0.019892828539013863,0.03720357269048691,0.09057724475860596,0.07755880802869797,0.010522366501390934,-0.050596509128808975,-0.0008717484888620675,0.033477626740932465,-0.1049906313419342,0.04424668103456497,0.08451522886753082,-0.04612797126173973,0.07361816614866257,-0.037799715995788574,0.010460615158081055,-0.05049646645784378,0.062386348843574524,0.04227527976036072,0.09385921061038971,0.01518702507019043,-0.045459698885679245,-0.0049086762592196465,0.0467081256210804,-0.04038221761584282,-0.021932296454906464,0.11803870648145676,-0.024153200909495354,-0.02684708498418331,-0.0028652087785303593,0.034612152725458145,0.03411226347088814,0.03330310061573982,0.05393534153699875,-0.023737100884318352,-5.251734691569254e-08,-0.026203542947769165,0.04247117415070534,-0.0019536258187144995,0.020530961453914642,-0.03415925055742264,-0.03411109372973442,0.011686836369335651,-0.143366739153862,0.0631447359919548,-0.040873441845178604,0.016173502430319786,-0.03274426981806755,-0.010198217816650867,-0.03624497726559639,0.01897209696471691,0.057654328644275665,0.013553177937865257,0.03549365699291229,0.004881339613348246,0.13578933477401733,-0.030487028881907463,-0.015656473115086555,0.03557982295751572,0.041611552238464355,-0.036991387605667114,-0.018697472289204597,-0.027030929923057556,0.06818921118974686,0.0018415924860164523,0.015001408755779266,0.04413187503814697,-0.0264756940305233,0.005170875228941441,-0.015515069477260113,-0.02765515446662903,0.06708107143640518,0.019262738525867462,0.01593104377388954,0.03393608704209328,0.045303232967853546,0.018745340406894684,-0.007967257872223854,-0.1577204167842865,-0.06261711567640305,0.026189390569925308,-0.010099702514708042,-0.042452894151210785,-0.07075285911560059,0.010097154416143894,0.06604162603616714,-0.04225350543856621,0.09622328728437424,0.020670216530561447,-0.023923909291625023,-0.04808186739683151,0.004529043100774288,-0.04657011106610298,0.0007172499317675829,-0.005970235448330641,0.016201907768845558,0.04715684801340103,0.03870879486203194,0.09454698860645294,-0.0203329399228096]'::vector)
ON CONFLICT (file_path) 
DO UPDATE SET 
    content = EXCLUDED.content,
    embedding = EXCLUDED.embedding,
    updated_at = NOW();


INSERT INTO embeddings (file_path, content, embedding)
VALUES ('database/models.py', '"""SQLAlchemy ORM models for Pix service database."""

from datetime import datetime
from decimal import Decimal
from uuid import uuid4

from sqlalchemy import (
    Boolean,
    Column,
    DateTime,
    Enum,
    ForeignKey,
    Numeric,
    String,
)
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship

from fake_pix_repo.domain.models import PixKeyType, TransactionStatus

Base = declarative_base()


class AccountModel(Base):
    """Database model for bank accounts."""
    
    __tablename__ = "accounts"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid4)
    account_number = Column(String(20), nullable=False)
    agency = Column(String(10), nullable=False)
    bank_code = Column(String(10), nullable=False)
    holder_name = Column(String(255), nullable=False)
    holder_document = Column(String(20), nullable=False, unique=True)
    balance = Column(Numeric(15, 2), nullable=False, default=Decimal("0.00"))
    created_at = Column(DateTime, nullable=False, default=datetime.utcnow)
    
    # Relationships
    pix_keys = relationship("PixModel", back_populates="account")


class PixModel(Base):
    """Database model for Pix key registrations."""
    
    __tablename__ = "pix_keys"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid4)
    key = Column(String(255), nullable=False, unique=True)
    key_type = Column(Enum(PixKeyType), nullable=False)
    account_id = Column(UUID(as_uuid=True), ForeignKey("accounts.id"), nullable=False)
    created_at = Column(DateTime, nullable=False, default=datetime.utcnow)
    is_active = Column(Boolean, nullable=False, default=True)
    
    # Relationships
    account = relationship("AccountModel", back_populates="pix_keys")


class TransactionModel(Base):
    """Database model for Pix transactions."""
    
    __tablename__ = "transactions"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid4)
    sender_key = Column(String(255), nullable=False)
    receiver_key = Column(String(255), nullable=False)
    amount = Column(Numeric(15, 2), nullable=False)
    description = Column(String(500), nullable=True)
    status = Column(Enum(TransactionStatus), nullable=False, default=TransactionStatus.PENDING)
    created_at = Column(DateTime, nullable=False, default=datetime.utcnow)
    completed_at = Column(DateTime, nullable=True)
', '[0.00012320616224315017,-0.062114614993333817,-0.06803698092699051,-0.042516253888607025,-0.12098012864589691,-0.01633637212216854,0.07080433517694473,5.026843791711144e-05,-0.022269079461693764,-0.012113763019442558,0.06775534152984619,-0.017514625564217567,0.09072878956794739,-0.052252333611249924,0.030357765033841133,-0.007603198755532503,-0.006670336239039898,-0.022394873201847076,-0.015117126516997814,0.017413342371582985,0.05147716403007507,-0.05484011024236679,0.04593459144234657,0.01305950153619051,-0.05231223627924919,-0.07527134567499161,0.08013783395290375,0.06939271837472916,-0.024171795696020126,-0.05069732293486595,-0.005410707090049982,0.10139097273349762,-0.05959409847855568,0.001860051299445331,0.04792250692844391,-0.020171480253338814,0.04881316423416138,-0.05751620605587959,0.028259137645363808,0.021046962589025497,0.025031747296452522,-0.03377757593989372,0.03622020408511162,-0.004168631974607706,-0.0006932860123924911,-0.011332947760820389,-0.008546801283955574,0.021793052554130554,-0.012692073360085487,0.004868817515671253,-0.038677096366882324,0.04066086933016777,0.03267505392432213,-0.009559628553688526,0.004396841395646334,0.030780624598264694,-0.0006431429646909237,-0.05555492639541626,-0.06308680027723312,-0.06943153589963913,-0.027365515008568764,0.03860119730234146,-0.028061343356966972,-0.012786726467311382,-0.11718156188726425,-0.00036820321111008525,-0.03509475290775299,0.007428566925227642,0.026153819635510445,-0.01866394281387329,0.008834177628159523,-0.04431511461734772,-0.1822725534439087,-0.0004755035333801061,-0.055285464972257614,0.029233591631054878,0.0858319029211998,0.010566303506493568,0.020253274589776993,-0.0625557005405426,-0.13468660414218903,-0.05177993327379227,0.03846537694334984,0.00327095459215343,0.011377103626728058,-0.06211728975176811,0.08773055672645569,0.009326252155005932,0.029783407226204872,-0.011617281474173069,0.043674666434526443,0.07898551970720291,0.080097496509552,-0.06600721925497055,0.03903135284781456,-0.03399757668375969,0.0365314856171608,0.027824269607663155,0.0907958373427391,0.027487661689519882,0.011874299496412277,0.024380149319767952,-0.02371089719235897,0.033637527376413345,0.013410637155175209,0.018009252846240997,0.033599015325307846,0.02158326469361782,-0.02936258725821972,-0.08894003927707672,0.004097294993698597,-0.0028850215021520853,0.039004482328891754,-0.04571732506155968,-0.005850883666425943,0.06848073750734329,-0.009015852585434914,-0.05976800248026848,0.019615817815065384,-0.05057818442583084,0.06570210307836533,0.07936965674161911,-0.0740974023938179,0.06412328034639359,-0.09865223616361618,0.041198115795850754,-0.07394237071275711,6.979873866199595e-33,-0.045545514672994614,0.030064160004258156,0.09112191945314407,-0.05654029920697212,-0.012768590822815895,0.055134475231170654,-0.004006917122751474,-0.00600172346457839,-0.037869568914175034,0.07319475710391998,-0.06107804551720619,0.03357311338186264,-0.0880342647433281,-0.008460763841867447,-0.05899929255247116,0.05092710629105568,-0.037507448345422745,0.020159997045993805,0.07345374673604965,0.09317207336425781,0.11276489496231079,-0.0037294395733624697,-0.009228026494383812,0.015940338373184204,0.06669893860816956,0.042126428335905075,-0.06459446251392365,-0.0342068076133728,-0.08286464959383011,-0.01466984674334526,-0.015312403440475464,-0.0778065100312233,0.010459761135280132,-0.07268746942281723,0.020752327516674995,0.0020812740549445152,0.046949539333581924,0.016999293118715286,-0.05872996523976326,-0.07660717517137527,-0.01939139887690544,-0.014027266763150692,-0.0033164958003908396,0.002625430002808571,-0.034596312791109085,0.038886334747076035,0.024664150550961494,0.06348975002765656,0.03859230503439903,0.032024040818214417,0.005847039166837931,-0.029800398275256157,-0.017109466716647148,0.02813018299639225,-0.11448407173156738,0.00267569487914443,0.027946453541517258,0.052605558186769485,0.024043837562203407,-0.05950477719306946,0.03583522513508797,-0.0246647410094738,-0.01383774820715189,0.002491443417966366,0.02928318828344345,0.06899193674325943,0.031297143548727036,0.03996226564049721,0.02932930737733841,0.04590284451842308,-0.03946659713983536,0.07751185446977615,-0.07329113036394119,0.029805248603224754,0.04355937987565994,-0.09972424805164337,0.06509874016046524,-0.058934327214956284,-0.02440555766224861,0.03992225229740143,0.0017669821390882134,0.009274371899664402,-0.07398670166730881,0.031445689499378204,-0.1497797816991806,0.02727649360895157,0.12354255467653275,0.029427357017993927,-0.02171744778752327,-0.058418042957782745,-0.05629606172442436,-0.01302697416394949,0.10707059502601624,0.0523531436920166,-0.01682608760893345,-9.528743817493656e-33,-0.046852514147758484,-0.03079494833946228,0.0410454198718071,-0.002806171542033553,0.06166445091366768,-0.025337863713502884,0.07588290423154831,0.05529870092868805,0.014007042162120342,-0.014027071185410023,-0.0014925614232197404,-0.01772824116051197,0.08859800547361374,0.02105422131717205,0.07733239978551865,0.011857576668262482,-0.022844722494482994,-0.05169475078582764,-0.08378073573112488,0.07624547928571701,-0.06124838441610336,0.1419050395488739,-0.043648917227983475,0.06782792508602142,-0.054390184581279755,0.0663343071937561,-0.054184217005968094,-0.042345743626356125,-0.0557364858686924,0.0223388671875,-0.03582652658224106,0.031419284641742706,-0.01795479841530323,0.04943430423736572,-0.10877665132284164,-0.040748290717601776,0.048811063170433044,0.0008395456243306398,0.020537691190838814,0.015097820200026035,-0.062114257365465164,0.009347273968160152,-0.005905589088797569,0.006518742069602013,0.030226845294237137,-0.010650995187461376,0.0307929590344429,-0.0016668896423652768,-0.026650892570614815,0.0004963094252161682,-0.06953246146440506,-0.024792613461613655,0.02280338667333126,0.05120430886745453,0.0011754768202081323,-0.014998253434896469,0.04636039212346077,-0.08800765872001648,0.04014354199171066,-0.056130848824977875,-0.05643318593502045,-0.005769963841885328,0.00657760351896286,0.11121039092540741,0.014983320608735085,-0.04981239512562752,-0.029934145510196686,-0.0506533607840538,-0.011588183231651783,-0.1065395399928093,-0.05981709063053131,0.04149511456489563,-0.046129852533340454,0.048455819487571716,0.02178090810775757,0.08360566943883896,-0.14685434103012085,-0.002797984052449465,-0.024456007406115532,0.025298796594142914,-0.05622204393148422,-0.04134640842676163,0.0482708141207695,0.02192537672817707,-0.06726884841918945,-0.08939862251281738,0.018428616225719452,0.03616764768958092,-0.012356622144579887,-0.011559897102415562,-0.012653699144721031,-0.1156274676322937,-0.06175399571657181,0.02409323863685131,-0.04711640253663063,-5.537626890372849e-08,-0.017760684713721275,0.026932623237371445,0.029888030141592026,0.05106508359313011,-0.02807009592652321,-0.11953962594270706,0.01701420545578003,-0.03327503800392151,0.0564834363758564,-0.01576429232954979,0.04323519393801689,0.0580703429877758,-0.023847803473472595,-0.032009195536375046,0.0004407771921250969,0.028351884335279465,-0.02793755941092968,-0.035291917622089386,0.019231071695685387,0.015452487394213676,-0.06565862894058228,-0.02017141692340374,-0.005732040852308273,-0.03923696279525757,0.02190982550382614,0.006494300439953804,-0.010857841931283474,0.11230181157588959,0.09027420729398727,0.009938611648976803,0.037971384823322296,-0.006175938528031111,0.0009334799833595753,-0.031400129199028015,0.004078916274011135,0.03254950791597366,0.07799118012189865,0.04957255721092224,0.024330876767635345,0.027230894193053246,-0.05112483352422714,-0.06005982682108879,-0.12292639166116714,-0.005770692136138678,0.0038001560606062412,-0.009399037808179855,-0.04194727540016174,-0.046783383935689926,0.09134068340063095,0.04669428616762161,-0.029271559789776802,0.014167937450110912,0.08423368632793427,-0.0243387408554554,-0.06749523431062698,0.04278215020895004,-0.04731032997369766,0.021862374618649483,0.0327279157936573,-0.08736144751310349,0.029609516263008118,0.017686421051621437,0.06037305295467377,-0.04555824026465416]'::vector)
ON CONFLICT (file_path) 
DO UPDATE SET 
    content = EXCLUDED.content,
    embedding = EXCLUDED.embedding,
    updated_at = NOW();
